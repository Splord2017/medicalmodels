{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "medical-models/model.schema.json",
  "title": "3D Printed Medical Model Schema",
  "description": "JSON schema for validating 3D printed medical model metadata",
  "type": "object",

  "required": [
    "name",
    "license",
    "doi_nih_3dpx",
    "image_atomized",
    "image_assembly",
    "purchase_materials",
    "keywords",
    "compatible_with",
    "hazards",
    "abstract",
    "print_data",
    "print_settings"
  ],

  "properties": {

    "name": {
      "type": "string",
      "description": "Name of the 3D printed model"
    },

    "license": {
      "type": "string",
      "description": "License information for the model"
    },

    "doi_nih_3dpx": {
      "type": "string",
      "description": "NIH 3D Print Exchange DOI identifier",
      "pattern": "^\\s*10\\.60705/3dpx/[0-9]+\\.[0-9]+$"
    },

    "image_atomized": {
      "type": "array",
      "description": "Array of URLs to atomized/detailed images",
      "items": { "type": "string", "format": "uri" }
    },

    "image_assembly": {
      "type": "array",
      "description": "Array of URLs to assembly images or videos",
      "items": { "type": "string", "format": "uri" }
    },

    "assembly_instructions": {
      "type": "string",
      "description": "Assembly instructions, or notes not covered in the assembly images/videos"
    },

    "purchase_materials": {
      "type": "string",
      "description": "Reference to materials purchase list"
    },

    "keywords": {
      "type": "array",
      "description": "Array of keywords and codes related to the model",
      "items": { "type": "string" }
    },

    "compatible_with": {
      "type": "array",
      "description": "Other models with compatible modular design",
      "items": { "type": "string" }
    },

    "hazards": {
      "type": "array",
      "description": "Potential hazards or safety considerations",
      "items": { "type": "string" }
    },

    "abstract": {
      "type": "string",
      "description": "Brief description of the model"
    },

    "print_data": {
      "type": "array",
      "description": "Array of individual 3D printable components",
      "minItems": 1,

      "items": {
        "type": "object",

        "required": [
          "id",
          "name",
          "file_format",
          "file_name",
          "layer_height_mm",
          "wall_thickness_mm",
          "top_thickness_mm",
          "bottom_thickness_mm",
          "infill_percent",
          "support",
          "build_plate_adhesion_required",
          "bed_glue",
          "dimensions"
        ],

        "properties": {

          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },

          "authors": {
            "type": "array",
            "items": { "type": "string" },
            "minItems": 1
          },

          "creation_date": {
            "type": "string",
            "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
          },

          "file_format": {
            "type": "string",
            "enum": ["STL", "OBJ", "PLY", "3MF", "AMF", "GCODE"]
          },

          "file_name": { "type": "string" },
          "file_size_mb": { "type": "number", "minimum": 0 },

          "atomized_model_reference": {
            "type": "integer",
            "minimum": 1
          },

          "model_version": { "type": "number", "minimum": 0 },

          "color": { "type": "string" },

          "layer_height_mm": {
            "type": "number",
            "minimum": 0.05,
            "maximum": 0.5
          },

          "wall_thickness_mm": { "type": "number", "minimum": 0 },
          "wall_line_count": { "type": "number", "minimum": 0 },

          "horizontal_expansion_mm": { "type": "number", "minimum": 0 },

          "top_thickness_mm": { "type": "number", "minimum": 0 },
          "top_layers_count": { "type": "number", "minimum": 0 },

          "bottom_thickness_mm": { "type": "number", "minimum": 0 },
          "bottom_layers_count": { "type": "number", "minimum": 0 },

          "infill_percent": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },

          "support_pattern": {
            "type": "string",
            "enum": [
              "cubic", "lines", "triangles", "trihexagon", "grid",
              "cubicsubdivision", "octet", "quartercubic", "concentric",
              "zigzag", "cross", "cross3d", "gyroid", "lightning"
            ]
          },

          "support": {
            "type": "object",
            "properties": {
              "generate_support": { "type": "boolean" },
              "support_structure": { "type": "string" },
              "support_placement": { "type": "string" },
              "support_overhang_angle_degree": {
                "type": "number",
                "minimum": 0,
                "maximum": 90
              }
            }
          },

          "build_plate_adhesion_required": { "type": "boolean" },

          "support_adhesion": { "type": "string" },

          "bed_glue": { "type": "boolean" },

          "dimensions": {
            "type": "object",
            "required": [
              "length_x_mm",
              "width_y_mm",
              "height_z_mm",
              "filament_length_m",
              "filament_mass_g",
              "print_time_min",
              "print_orientation_x_axis_mm",
              "print_orientation_y_axis_mm",
              "print_orientation_z_axis_mm",
              "print_rotation_degrees"
            ],
            "properties": {
              "length_x_mm": { "type": "number" },
              "width_y_mm": { "type": "number" },
              "height_z_mm": { "type": "number" },

              "filament_length_m": { "type": "number" },
              "filament_mass_g": { "type": "number" },
              "print_time_min": { "type": "number" },

              "print_orientation_x_axis_mm": { "type": "number" },
              "print_orientation_y_axis_mm": { "type": "number" },
              "print_orientation_z_axis_mm": { "type": "number" },

              "print_rotation_degrees": {
                "type": "object",
                "properties": {
                  "x": { "type": "number" },
                  "y": { "type": "number" },
                  "z": { "type": "number" }
                }
              }
            }
          }
        }
      }
    },

    "print_settings": {
      "type": "object",

      "required": [
        "printer",
        "material",
        "material_size_mm",
        "nozzle_size_mm",
        "nozzle_temp_celsius",
        "bed_temp_celsius",
        "extrusion_path_parameters",
        "fan_speed_percent",
        "computer_aided_design_software",
        "slicer_software",
        "postprocessing"
      ],

      "properties": {

        "printer": { "type": "string" },

        "material": {
          "type": "string",
          "enum": ["PLA", "ABS", "PETG", "TPU", "NYLON", "ASA", "PC", "PVA", "HIPS"]
        },

        "material_size_mm": {
          "type": "number",
          "enum": [1.75, 2.85, 3.0]
        },

        "nozzle_size_mm": {
          "type": "number",
          "minimum": 0
        },

        "nozzle_temp_celsius": {
          "type": "number",
          "minimum": 150,
          "maximum": 300
        },

        "bed_temp_celsius": {
          "type": "number",
          "minimum": 0,
          "maximum": 150
        },

        "extrusion_path_parameters": {
          "type": "object",
          "properties": {
            "line_width": { "type": "number", "minimum": 0 },
            "flow_percent": { "type": "number", "minimum": 0 },
            "print_speed_mm_s": { "type": "number", "minimum": 0 },
            "travel_speed_mm_s": { "type": "number", "minimum": 0 },
            "initial_layer_speed_mm_s": { "type": "number", "minimum": 0 }
          }
        },

        "fan_speed_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },

        "computer_aided_design_software": {
          "type": "object",
          "required": ["name", "version"],
          "properties": {
            "name": { "type": "string" },
            "version": {
              "type": "string",
              "pattern": "^[0-9]+(\\.[0-9]+)*$"
            }
          }
        },

        "slicer_software": {
          "type": "object",
          "required": ["name", "version"],
          "properties": {
            "name": { "type": "string" },
            "version": {
              "type": "string",
              "pattern": "^[0-9]+(\\.[0-9]+)*$"
            }
          }
        },

        "postprocessing": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
